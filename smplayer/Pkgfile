# Description: Front-end for mpv
# URL:         https://www.smplayer.info/
# Depends on:  hicolor-icon-theme qt5

# Maintainer notes on dependencies:
#   yt-dlp: Youtube support (auto-enabled if installed)

name=smplayer
version=25.6.0.10388
release=1

case $version in
*.*.*.*) _tag="v${version##*.}" ;; # testing
      *) _tag="v$version"       ;; # stable
esac

source="https://github.com/smplayer-dev/$name/releases/download/$_tag/smplayer-$version.tar.bz2"

build() {
	cd $name-$version

	# pkgmk compresses manpages by itself
	sed '/gzip -9/d' -i Makefile

	export CXXFLAGS="$CXXFLAGS $CPPFLAGS"

	make PREFIX=/usr QMAKE_OPTS=DEFINES+=NO_DEBUG_ON_CONSOLE \
		CFLAGS_EXTRA="$CFLAGS $CPPFLAGS $LDFLAGS" all
	make PREFIX=/usr DESTDIR=$PKG install

	# Remove i18n entries from .desktop
	sed -ri '/\[.+\]=/d' $PKG/usr/share/applications/*.desktop

	# Remove junk
	rm -r $PKG/usr/share/doc
}
