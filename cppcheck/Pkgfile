# Description: Static analysis tool for C/C++ code
# URL:         https://cppcheck.sourceforge.io/
# Depends on:  libpcre

name=cppcheck
version=2.19.1
release=1
source=https://github.com/danmar/$name/archive/$version/$name-$version.tar.gz

build() {
	export HAVE_RULES=yes
	export MATCHCOMPILER=yes
	export FILESDIR=/usr/share/cppcheck

	# Do not force -pipe; respect global CXXFLAGS
	sed -i '/CXXFLAGS /s/ -pipe/ /g' $name-$version/Makefile

	make -C $name-$version DESTDIR=$PKG install

	# cppcheck-htmlreport pulls py3-pygments and its dependency chain
	# Remove to keep runtime footprint minimal
	rm $PKG/usr/bin/cppcheck-htmlreport

	# Man page generation requires docbook-{xml,xsl}
	# Intentionally skipped to avoid heavy build-time dependencies
	#
	# make man \
	#   DB2MAN=/usr/share/xml/docbook/xsl-stylesheets/manpages/docbook.xsl
	# install -m 0644 -D $name.1 $PKG/usr/share/man/man1/$name.1
}
